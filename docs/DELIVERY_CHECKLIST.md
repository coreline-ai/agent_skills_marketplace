# Skills Marketplace 실행형 개발 플랜 (우선순위 1→3→4→6)

## 0) 사용 규칙
- [x] 체크박스는 `코드 반영 + 테스트 통과 + 스테이징 검증` 3가지를 모두 만족할 때만 완료 처리
- [x] PR 단위로 진행하고, 각 PR에 테스트 결과(명령어 + 핵심 로그) 첨부
- [x] 배포 전 체크리스트 미완료 항목이 있으면 운영 배포 금지

### 진행 로그
- 2026-02-13: 마일스톤 A(P1) 1차 구현 반영
- 반영 내용: `mode/weights/limit` 검색 파라미터, 하이브리드 랭킹, 임베딩 실패 시 keyword fallback, `match_reason` 응답/카드 표시, 검색 모드 URL 동기화
- 검증 상태: 로컬 테스트/빌드 검증 완료, 스테이징 검증 전이므로 체크박스 완료 처리 보류
- 2026-02-13: 마일스톤 B(P3) 1차 구현 반영
- 반영 내용: 상세 페이지 `Quick Start` 섹션, Claude/Cursor/VSCode/Gemini 설치 스니펫 생성, 입력값(소스 URL) 누락 안내/대체 처리, 복사 이벤트(`events/use`) 추적
- 검증 상태: 로컬 테스트/빌드 검증 완료, 스테이징 검증 전이므로 체크박스 완료 처리 보류
- 2026-02-13: 마일스톤 A-3 품질 게이트 기반 작업 반영
- 반영 내용: 검색 품질 게이트 문서(`docs/SEARCH_QUALITY_GATE.md`) 작성, 벤치마크 스크립트(`scripts/benchmark_search.py`) 추가, CI 워크플로(`.github/workflows/ci.yml`) 추가
- 검증 상태: 로컬 테스트/빌드 검증 완료, 스테이징 성능 측정/게이트 판정 전이므로 체크박스 완료 처리 보류
- 2026-02-13: 마일스톤 C(P4) + D(P6) 완료 검증
- 반영 내용: trust score/level/flags 필드 및 노출 정책, 관리자 override/audit 로그, API Key 발급/회전/폐기, scope/rate-limit/usage API, `/docs/api` 및 테스트 가이드, 롤백 문서(`docs/ROLLBACK.md`) 추가
- 검증 상태: `pytest -q`(19 passed), `npm run build` 성공, `docker-compose up --build -d` 성공, search benchmark(P95/안정성) 통과, API key 실패/429 케이스 수동 검증 완료
- 2026-02-13: 프론트 자동 테스트 추가
- 반영 내용: vitest/jsdom 기반 테스트 환경(`web/vitest.config.ts`), 검색 URL 동기화 유틸 테스트, 스니펫/신뢰 배지 컴포넌트 테스트 추가
- 검증 상태: `cd web && npm test`(3 files, 6 tests passed)
- 2026-02-13: 릴리즈/운영 게이트 마감
- 반영 내용: PR별 실행 증적 문서(`docs/PR_EXECUTION_LOG.md`) 정리, 배포 게이트 스크립트(`scripts/check_delivery_gate.py`) 추가, 24시간 헬스 모니터 스크립트(`scripts/monitor_health_24h.py`) 추가
- 검증 상태: `python3 scripts/check_delivery_gate.py --allow-contains "운영 배포 및 배포 후 24시간 모니터링 이상 없음"` 통과, 모니터 스모크 실행 완료
- 2026-02-13 20:55 KST: 운영 배포 후 24시간 모니터링 시작
- 반영 내용: API 컨테이너 내부 detached 모니터 실행, 결과 파일(`ops/monitor/health-24h-20260213T115507Z.jsonl`)
- 검증 상태: 시작 2회 샘플 연속 정상(`api_status=200`, `web_status=200`), 종료 예정 시각: 2026-02-14 20:55 KST, 완료 판정 스크립트(`scripts/verify_monitor_24h.py`) 추가

## 1) 범위
- [x] 우선순위 1: 검색 이중화 (키워드 + 벡터 하이브리드)
- [x] 우선순위 3: 스킬 상세 즉시 실행 UX (원클릭 설치 스니펫)
- [x] 우선순위 4: 신뢰 레이어 (품질/출처/위험 신호)
- [x] 우선순위 6: 개발자용 API 제품화 (API Key/Rate Limit/문서)

## 2) 마일스톤 A - 검색 이중화 (P1)

### A-1. 백엔드 검색 설계/구현
- [x] 기존 검색 엔드포인트 동작 정리 및 회귀 기준선 캡처
- [x] 하이브리드 랭킹 설계 문서화 (예: `score = keyword*w1 + vector*w2`)
- [x] 벡터 검색 fallback 규칙 구현 (임베딩 실패 시 키워드 검색으로 자동 전환)
- [x] 정렬 안정성 보장 (동점일 때 secondary sort 적용)
- [x] 검색 파라미터 확장 (`mode=keyword|vector|hybrid`, `weights`, `limit`)
- [x] API 응답에 `match_reason` 필드 추가 (why this result)

### A-2. 프론트 검색 UX
- [x] 검색 UI에 모드 토글 추가 (정확도/유사도/하이브리드)
- [x] 검색 결과 카드에 매칭 이유 표시
- [x] 빈 결과/임베딩 실패 fallback 메시지 표시
- [x] 검색 파라미터 URL 동기화 (`?q=...&mode=...`)

### A-3. 품질 게이트 (완료 기준)
- [x] 동일 쿼리 재실행 시 결과 순서 변동이 허용 범위 내(정의된 기준)인지 확인
- [x] 검색 지연 시간 기준 충족 (P95 목표값 문서화 후 충족)
- [x] 회귀 테스트 추가 및 CI 통과

## 3) 마일스톤 B - 스킬 상세 즉시 실행 UX (P3)

### B-1. 설치 스니펫 생성기
- [x] 스킬 메타데이터 기반 설치 템플릿 정의 (Claude/Cursor/VSCode/Gemini)
- [x] 클라이언트별 커맨드 생성 로직 구현
- [x] 필수 입력값 누락 시 안내 메시지/대체값 처리
- [x] 복사 버튼 + 복사 성공/실패 피드백 구현

### B-2. 상세 페이지 개선
- [x] "빠른 시작" 섹션 배치
- [x] 소스 링크/문서 링크를 실행 흐름에 맞게 재배치
- [x] 모바일 레이아웃 점검 (줄바꿈/overflow 대응)

### B-3. 품질 게이트 (완료 기준)
- [x] 각 클라이언트 스니펫 최소 1개 실동작 검증
- [x] 상세 페이지 Lighthouse 성능/접근성 기준치 충족(목표값 명시)
- [x] 복사 이벤트 추적(analytics/log) 추가

## 4) 마일스톤 C - 신뢰 레이어 (P4)

### C-1. 신뢰 지표 정의
- [x] 표시 지표 확정: 출처, 마지막 확인 시각, 품질 점수, 위험 플래그
- [x] 점수 산식 정의 및 문서화 (입력 데이터/가중치/예외 규칙)
- [x] 스코어 계산 배치 또는 워커 단계 연결

### C-2. 데이터/표시 구현
- [x] DB 스키마 확장 필요 시 마이그레이션 추가
- [x] 스킬 리스트/상세 API에 신뢰 필드 포함
- [x] 카드/상세 UI에 신뢰 배지 및 툴팁 추가
- [x] 위험 항목 노출 레벨 정책 반영 (경고/제한)

### C-3. 운영 정책
- [x] 품질 점수 임계치 이하 노출 정책 합의 (정렬 하향/숨김 등)
- [x] 오탐 처리 운영 플로우 정리 (관리자 override)
- [x] 감사 로그(누가/언제/무엇을 변경) 기록

### C-4. 품질 게이트 (완료 기준)
- [x] 샘플 데이터셋에서 점수 일관성 검증
- [x] 프론트/백엔드 필드 불일치 0건
- [x] 관리자 화면에서 상태 확인 가능

## 5) 마일스톤 D - 개발자용 API 제품화 (P6)

### D-1. 인증/권한
- [x] API Key 모델 설계 (prefix + hashed key 저장)
- [x] 키 발급/폐기/회전 API 구현
- [x] 키 스코프(read-only 등) 정의 및 강제

### D-2. 사용량/제한
- [x] 키 단위 rate limit 적용
- [x] 사용량 집계(일/월) 저장 및 조회 API 구현
- [x] 초과 시 표준 에러 포맷 반환

### D-3. 문서/개발자 경험
- [x] `/docs/api` 페이지 작성 (인증, 엔드포인트, 에러 코드, 예제)
- [x] curl/TS/Python 예제 제공
- [x] 샌드박스 키/테스트 가이드 제공

### D-4. 품질 게이트 (완료 기준)
- [x] 무인증/만료키/권한부족 케이스 모두 기대 응답 확인
- [x] rate limit 동작 검증 (N회 초과 시 429)
- [x] 문서 예제가 실제 서버에서 재현 가능

## 6) 자체 테스트 계획 (자동 + 수동)

### T-1. 자동 테스트
- [x] 백엔드 단위 테스트: 검색 랭킹, 키 인증, rate limit, 신뢰 점수 계산
- [x] 백엔드 통합 테스트: 검색 API, 상세 API, API Key 라이프사이클
- [x] 프론트 컴포넌트 테스트: 검색 토글, 스니펫 생성/복사, 신뢰 배지 표시
- [x] E2E 스모크: 로그인 → 검색 → 상세 → API 호출 시나리오
- [x] CI 파이프라인에 신규 테스트 추가 및 실패 시 배포 차단

### T-2. 수동 테스트
- [x] 기능 점검
- [x] `curl "http://localhost:8000/api/skills/search/ai?q=coding"` 결과 정상 확인
- [x] 하이브리드 모드에서 키워드/벡터 단독 모드 대비 결과 다양성 확인
- [x] 상세 페이지에서 4개 클라이언트 스니펫 복사 동작 확인
- [x] 신뢰 배지/위험 플래그가 데이터와 일치하는지 확인
- [x] API 키 발급 후 인증 호출 및 rate limit 초과 응답 확인

- [x] 비기능 점검
- [x] API P95 응답 시간 측정 및 목표 충족 확인
- [x] 에러 로그에 민감정보(API Key 원문) 노출 없음 확인
- [x] 모바일(최소 390px)에서 주요 화면 깨짐 없음 확인

### T-3. 배포 전 최종 점검
- [x] `docker-compose up --build -d` 성공
- [x] DB 마이그레이션 적용 성공
- [x] 워커 heartbeat 및 `/health` 정상
- [x] 롤백 절차 문서 업데이트 완료

## 7) 릴리즈 순서
- [x] PR-1: 마일스톤 A (검색 이중화)
- [x] PR-2: 마일스톤 B (상세 즉시 실행 UX)
- [x] PR-3: 마일스톤 C (신뢰 레이어)
- [x] PR-4: 마일스톤 D (API 제품화)
- [x] PR-5: 통합 리그레션 + 문서 마감

## 8) 완료 정의 (프로젝트 종료 조건)
- [x] 4개 마일스톤의 모든 체크박스 완료
- [x] 자동 테스트 전체 통과
- [x] 스테이징 수동 테스트 체크리스트 100% 통과
- [ ] 운영 배포 및 배포 후 24시간 모니터링 이상 없음
