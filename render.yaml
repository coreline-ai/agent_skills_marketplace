services:
  # 1. API & Worker Service (Combined for Free Tier)
  - type: web
    name: skills-marketplace-api
    env: docker
    dockerContext: .
    dockerfilePath: Dockerfile.api
    plan: free

    envVars:
      - key: DATABASE_URL
        sync: false
      - key: ADMIN_USERNAME
        value: admin
      - key: ADMIN_PASSWORD_HASH
        value: "$2b$12$IkI2Kx6zDQnaJs2GYMQFwOHVpcyUIzgP6rzEGtyjgtab6vu61F8m."
      - key: JWT_SECRET_KEY
        generateValue: true
      - key: PORT
        value: 10000
      - key: CORS_ORIGINS
        value: "https://skills-marketplace-web-3a6p.onrender.com,http://localhost:3000,http://localhost:3004"
    healthCheckPath: /health
    buildFilter:
      paths:
        - app/**
        - migrations/**
        - scripts/**
        - Dockerfile.api
        - pyproject.toml
        - alembic.ini
        - render.yaml
      ignoredPaths:
        - README.md
        - docs/**
        - web/**

  # 2. Web Frontend (Next.js)
  - type: web
    name: skills-marketplace-web
    env: docker
    dockerContext: .
    dockerfilePath: web/Dockerfile
    plan: free
    envVars:
      - key: NEXT_PUBLIC_API_URL
        value: https://skills-marketplace-api-3a6p.onrender.com/api
      - key: PORT
        value: 10000
    healthCheckPath: /health
    buildFilter:
      paths:
        - web/**
        - render.yaml
      ignoredPaths:
        - README.md
        - docs/**
        - app/**
        - migrations/**
        - scripts/**
        - Dockerfile.api
        - pyproject.toml
        - alembic.ini
